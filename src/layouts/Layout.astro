---
import "../styles/global.css";
import { ClientRouter } from "astro:transitions";
import {
  MapPin,
  Phone,
  Mail,
  Facebook,
  Twitter,
  Linkedin,
  Instagram,
  ArrowRight,
  Menu,
  X,
} from "lucide-react";
import SpeedInsights from "@vercel/speed-insights/astro";
import Analytics from "@vercel/analytics/astro";
import Footer from "../components/Footer.jsx";

/**
 * Layout Component
 * Main layout wrapper with navbar and footer
 *
 * @param {Object} props
 * @param {string} props.title - Page title
 */
const { title = "Instalaciones García's" } = Astro.props;
---

<!doctype html>
<html lang="es" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <!-- SEO Meta Tags -->
    <meta
      name="description"
      content="Instalaciones García's - Soluciones profesionales en instalaciones eléctricas, mantenimiento industrial y proyectos institucionales con más de 15 años de experiencia."
    />
    <meta
      name="keywords"
      content="instalaciones eléctricas, mantenimiento industrial, proyectos institucionales, electricidad, construcción, ingeniería eléctrica, CDMX"
    />
    <meta name="author" content="Instalaciones García's" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href={Astro.url} />

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url} />
    <meta property="og:title" content={title} />
    <meta
      property="og:description"
      content="Soluciones profesionales en instalaciones eléctricas y proyectos institucionales con calidad premium."
    />
    <meta
      property="og:image"
      content="https://images.unsplash.com/photo-1541888946425-d81bb19240f5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80"
    />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={Astro.url} />
    <meta property="twitter:title" content={title} />
    <meta
      property="twitter:description"
      content="Soluciones profesionales en instalaciones eléctricas y proyectos institucionales con calidad premium."
    />
    <meta
      property="twitter:image"
      content="https://images.unsplash.com/photo-1541888946425-d81bb19240f5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80"
    />

    <title>{title}</title>
    <ClientRouter />

    <!-- JSON-LD Structured Data for Local Business -->
    <script type="application/ld+json" is:inline>
      {
        "@context": "https://schema.org",
        "@type": "GeneralContractor",
        "name": "Instalaciones García's",
        "image": "https://instalacionesgarciasfronted.vercel.app/favicon.svg",
        "@id": "https://instalacionesgarciasfronted.vercel.app",
        "url": "https://instalacionesgarciasfronted.vercel.app",
        "telephone": "+525589001234",
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "Av. Tecnológico 2405, Piso 8",
          "addressLocality": "Ciudad de México",
          "postalCode": "11560",
          "addressCountry": "MX"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": 19.4326,
          "longitude": -99.1332
        },
        "openingHoursSpecification": {
          "@type": "OpeningHoursSpecification",
          "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
          "opens": "08:00",
          "closes": "18:00"
        },
        "sameAs": [
          "https://www.facebook.com/instalacionesgarcias",
          "https://www.instagram.com/instalacionesgarcias"
        ]
      }
    </script>
  </head>
  <body
    class="flex flex-col min-h-screen font-sans bg-primary text-text-main antialiased selection:bg-white selection:text-black"
  >
    {
      process.env.VERCEL === "1" && (
        <>
          <SpeedInsights />
          <Analytics />
        </>
      )
    }

    <!-- Scroll Progress Bar -->
    <div class="fixed top-0 left-0 w-full h-1 z-[60] pointer-events-none">
      <div id="scroll-progress" class="h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 origin-left transform scale-x-0 transition-transform duration-100 ease-out shadow-[0_0_10px_rgba(168,85,247,0.5)]"></div>
    </div>

    <!-- Navbar with Premium Glassmorphism -->
    <header
      id="navbar"
      class="fixed top-0 w-full z-50 transition-all duration-500 border-b border-white/0"
    >
      <div
        class="absolute inset-0 bg-black/0 backdrop-blur-[0px] transition-all duration-500"
        id="navbar-bg"
      >
      </div>

      <nav
        class="container mx-auto flex items-center justify-between py-4 px-6 relative z-50"
      >
        <!-- Logo / Brand -->
        <a
          href="/"
          class="text-lg md:text-xl lg:text-2xl font-bold tracking-tighter text-white hover:text-gray-200 transition-colors duration-300 flex items-center gap-3 group"
        >
          <div
            class="w-10 h-10 bg-white text-black flex items-center justify-center rounded-xl font-black text-sm shadow-[0_0_15px_rgba(255,255,255,0.3)] group-hover:scale-110 group-hover:rotate-3 transition-all duration-300"
          >
            IG
          </div>
          <span class="hidden sm:inline-block group-hover:tracking-wide transition-all duration-300">Instalaciones <span class="font-light text-gray-300 group-hover:text-white">García's</span></span>
        </a>

        <!-- Desktop Navigation Links -->
        <ul class="hidden md:flex items-center gap-1 bg-white/5 backdrop-blur-md px-2 py-1.5 rounded-full border border-white/10 hover:border-white/20 transition-colors duration-300">
          {
            ["Inicio", "Servicios", "Proyectos", "Contacto"].map((item) => (
              <li>
                <a
                  href={item === "Inicio" ? "/" : `/${item.toLowerCase()}`}
                  class="px-5 py-2 rounded-full text-sm font-medium text-gray-300 hover:text-white hover:bg-white/10 transition-all duration-300 block hover:shadow-[0_0_10px_rgba(255,255,255,0.1)]"
                >
                  {item}
                </a>
              </li>
            ))
          }
        </ul>

        <!-- CTA Button -->
        <div class="hidden md:block">
          <a
            href="/contacto"
            class="relative px-6 py-2.5 group overflow-hidden rounded-full bg-white text-black font-bold text-xs uppercase tracking-wider transition-all duration-300 hover:shadow-[0_0_25px_rgba(255,255,255,0.5)] hover:scale-105 flex items-center gap-2"
          >
            <span class="relative z-10">Cotizar</span>
            <ArrowRight size={14} className="relative z-10 group-hover:translate-x-1 transition-transform" />
            <div
              class="absolute inset-0 bg-gradient-to-r from-gray-100 via-white to-gray-100 opacity-0 group-hover:opacity-100 transition-opacity duration-300"
            >
            </div>
          </a>
        </div>

        <!-- Mobile Menu Button -->
        <button
          id="mobile-menu-button"
          class="md:hidden relative w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 border border-white/10 transition-all duration-300 flex items-center justify-center group z-50 hover:shadow-[0_0_15px_rgba(255,255,255,0.2)]"
          aria-label="Toggle mobile menu"
        >
          <Menu className="w-5 h-5 text-white transition-all duration-300 group-aria-expanded:opacity-0 group-aria-expanded:rotate-90 absolute" />
          <X className="w-5 h-5 text-white transition-all duration-300 opacity-0 -rotate-90 group-aria-expanded:opacity-100 group-aria-expanded:rotate-0 absolute" />
        </button>
      </nav>

      <!-- Mobile Menu Overlay -->
      <div
        id="mobile-menu"
        class="fixed inset-0 bg-black/95 backdrop-blur-xl z-40 flex items-center justify-center opacity-0 pointer-events-none transition-all duration-500"
      >
        <!-- Background Decoration -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
           <div class="absolute top-1/4 left-1/4 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl animate-pulse"></div>
           <div class="absolute bottom-1/4 right-1/4 w-64 h-64 bg-purple-500/10 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
        </div>

        <ul class="flex flex-col items-center gap-8 relative z-10">
          {
            ["Inicio", "Servicios", "Proyectos", "Contacto"].map((item, index) => (
              <li class="transform translate-y-4 opacity-0 transition-all duration-500" style={`transition-delay: ${index * 100}ms`}>
                <a
                  href={item === "Inicio" ? "/" : `/${item.toLowerCase()}`}
                  class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-b from-white to-white/50 hover:to-white transition-all duration-300 hover:scale-110 inline-block"
                >
                  {item}
                </a>
              </li>
            ))
          }
        </ul>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow">
      <slot />
    </main>

    <!-- Premium Footer -->
    <Footer client:visible />
  </body>
</html>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
  }

  /* Custom Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
  }
  ::-webkit-scrollbar-track {
    background: #000;
  }
  ::-webkit-scrollbar-thumb {
    background: #333;
    border-radius: 4px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: #555;
  }
</style>

<script>
  function setupLayout() {
    // Navbar Scroll Effect
    const navbar = document.getElementById("navbar");
    const navbarBg = document.getElementById("navbar-bg");
    const scrollProgress = document.getElementById("scroll-progress");

    const onScroll = () => {
      const scrollY = window.scrollY;
      const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
      const progress = scrollY / maxScroll;

      // Update progress bar
      if (scrollProgress) {
        scrollProgress.style.transform = `scaleX(${progress})`;
      }

      // Navbar styling
      if (scrollY > 20) {
        navbarBg?.classList.remove("bg-black/0", "backdrop-blur-[0px]");
        navbarBg?.classList.add("bg-black/80", "backdrop-blur-md");
        navbar?.classList.add("border-white/10");
        navbar?.classList.remove("border-white/0");
      } else {
        navbarBg?.classList.add("bg-black/0", "backdrop-blur-[0px]");
        navbarBg?.classList.remove("bg-black/80", "backdrop-blur-md");
        navbar?.classList.remove("border-white/10");
        navbar?.classList.add("border-white/0");
      }
    };

    window.addEventListener("scroll", onScroll);

    // Mobile Menu Logic
    const menuBtn = document.getElementById("mobile-menu-button");
    const mobileMenu = document.getElementById("mobile-menu");
    const menuItems = mobileMenu?.querySelectorAll("li");

    if (menuBtn && mobileMenu) {
      menuBtn.addEventListener("click", () => {
        const isExpanded = menuBtn.getAttribute("aria-expanded") === "true";
        menuBtn.setAttribute("aria-expanded", !isExpanded ? "true" : "false");

        if (!isExpanded) {
          // Open
          mobileMenu.classList.remove("opacity-0", "pointer-events-none");
          document.body.style.overflow = "hidden"; // Prevent scrolling
          
          // Animate items
          menuItems?.forEach((item) => {
            item.classList.remove("translate-y-4", "opacity-0");
          });
        } else {
          // Close
          mobileMenu.classList.add("opacity-0", "pointer-events-none");
          document.body.style.overflow = ""; // Restore scrolling
          
          // Reset items
          menuItems?.forEach((item) => {
            item.classList.add("translate-y-4", "opacity-0");
          });
        }
      });

      // Close on link click
      mobileMenu.querySelectorAll("a").forEach(link => {
        link.addEventListener("click", () => {
          menuBtn.click();
        });
      });
    }
  }

  // Run on load and navigation
  setupLayout();
  document.addEventListener("astro:page-load", setupLayout);
</script>
